/*!
 * modDevTools - Rapid site development helper for MODx Revolution
 * Version: 1.3.6
 * Build date: 2023-03-10
 */
var moddevtools=function(e){moddevtools.superclass.constructor.call(this,e=e||{})};Ext.extend(moddevtools,Ext.Component,{initComponent:function(){this.stores={},this.ajax=new Ext.data.Connection({disableCaching:!0})},page:{},window:{},grid:{},tree:{},panel:{},combo:{},config:{},view:{},util:{}}),Ext.reg("moddevtools",moddevtools),(modDevTools=new moddevtools).util.dateRenderer=function(e){return function(e){var t;return"string"==typeof e&&""!==e&&Date.parseDate(e,"Y-m-d H:i:s")?(t=t||MODx.config.manager_date_format+" "+MODx.config.manager_time_format,e=Date.parseDate(e,"Y-m-d H:i:s"),Ext.util.Format.date(e,t)):e}},modDevTools.util.yesnoRenderer=function(e,t){return t.css=1===parseInt(e)||e?"green":"red",1===parseInt(e)||e?_("yes"):_("no")},modDevTools.util.getMenu=function(e,t,o){var s,i,n,l,a,r=[];for(a in e)if(e.hasOwnProperty(a)){var d=e[a];if(d.menu){if(0<r.length&&/^remove/i.test(d.action)&&r.push("-"),1<o.length){if(!d.multiple)continue;"string"==typeof d.multiple&&(d.title=d.multiple)}d.title&&(s=d.cls||"",i=d.icon||"",n=d.title||"",l=d.action?t[d.action]:"",r.push({handler:l,text:String.format('<span class="{0}"><i class="x-menu-item-icon {1}"></i>{2}</span>',s,i,n)}))}else"-"===d&&r.push("-")}return r},modDevTools.util.actionsRenderer=function(e,t,o){var s,i,n,l,a,r=[];for(l in o.data.actions)o.data.actions.hasOwnProperty(l)&&((a=o.data.actions[l]).button&&(n=a.cls||"",s=a.icon||"",i=a.action||"",a=a.title||"",n=String.format('<li class="{0}"><a class="action" href="#" data-action="{2}" title="{3}"><i class="{1}"></i></a></li>',n,s,i,a),r.push(n)));return String.format('<ul class="moddevtools-row-actions">{0}</ul>',r.join(""))},modDevTools.util.addTab=function(e,t){e=Ext.getCmp(e);e&&(Ext.applyIf(t,{id:"modx-"+Ext.id()+"-tab",layout:"form",labelAlign:"left",autoHeight:!0,defaults:{border:!1,msgTarget:"side",width:400}}),e.add(t),e.doLayout(),e.setActiveTab(0))},modDevTools.panel.Home=function(e){e=e||{},Ext.apply(e,{cls:"container home-panel"+(modDevTools.config.debug?" debug":"")+" modx"+modDevTools.config.modxversion,defaults:{collapsible:!1,autoHeight:!0},items:[{html:"<h2>"+_("moddevtools")+"</h2>"+(modDevTools.config.debug?'<div class="ribbon top-right"><span>'+_("moddevtools.debug_mode")+"</span></div>":""),border:!1,cls:"modx-page-header"},{defaults:{autoHeight:!0},border:!0,items:[{xtype:"moddevtools-panel-overview"}]},{cls:"treehillstudio_about",html:'<img width="146" height="40" src="'+modDevTools.config.assetsUrl+'img/mgr/treehill-studio-small.png" srcset="'+modDevTools.config.assetsUrl+'img/mgr/treehill-studio-small@2x.png 2x" alt="Treehill Studio">',listeners:{afterrender:function(){this.getEl().select("img").on("click",function(){var e='<span style="display: inline-block; text-align: center;">&copy; 2014-2019 by Vitaly Kireev <a href="https://github.com/argnist" target="_blank">github.com/argnist</a><br><img src="'+modDevTools.config.assetsUrl+'img/mgr/treehill-studio.png" srcset="'+modDevTools.config.assetsUrl+'img/mgr/treehill-studio@2x.png 2x" alt="Treehill Studio" style="margin-top: 10px"><br>&copy; 2019-2023 by <a href="https://treehillstudio.com" target="_blank">treehillstudio.com</a></span>';Ext.Msg.show({title:_("moddevtools")+" "+modDevTools.config.version,msg:e,buttons:Ext.Msg.OK,cls:"treehillstudio_window",width:358})})}}}]}),modDevTools.panel.Home.superclass.constructor.call(this,e)},Ext.extend(modDevTools.panel.Home,MODx.Panel),Ext.reg("moddevtools-panel-home",modDevTools.panel.Home),modDevTools.panel.FormTab=function(e){e=e||{},Ext.applyIf(e,{id:"moddevtools-panel-"+e.formtype,title:e.title,items:[{html:"<p>"+e.description+"</p>",border:!1,cls:"panel-desc"},{layout:"form",cls:"x-form-label-left main-wrapper",defaults:{autoHeight:!0},border:!0,items:[{id:"moddevtools-panel-"+e.formtype+"-form",xtype:"moddevtools-"+e.formtype+"-form",preventRender:!0}]}]}),modDevTools.panel.FormTab.superclass.constructor.call(this,e)},Ext.extend(modDevTools.panel.FormTab,MODx.Panel),Ext.reg("moddevtools-panel-formtab",modDevTools.panel.FormTab),modDevTools.panel.Overview=function(e){e=e||{},this.ident="moddevtools-panel-overview-"+Ext.id(),this.panelOverviewTabs=[{xtype:"moddevtools-panel-formtab",title:_("moddevtools.search"),description:_("moddevtools.search_desc"),formtype:"search"},{xtype:"moddevtools-panel-formtab",title:_("moddevtools.regenerate"),description:_("moddevtools.regenerate_desc"),formtype:"regenerate"}],modDevTools.config.is_admin&&this.panelOverviewTabs.push({xtype:"moddevtools-panel-settings"}),Ext.applyIf(e,{id:"moddevtools-panel-overview",items:[{xtype:"modx-tabs",border:!0,stateful:!0,stateId:"moddevtools-panel-overview",stateEvents:["tabchange"],getState:function(){return{activeTab:this.items.indexOf(this.getActiveTab())}},autoScroll:!0,deferredRender:!0,forceLayout:!1,defaults:{layout:"form",autoHeight:!0,hideMode:"offsets"},items:this.panelOverviewTabs,listeners:{tabchange:function(e,t){"moddevtools-panel-settings"===t.xtype&&Ext.getCmp("moddevtools-grid-system-settings").getStore().reload()}}}]}),modDevTools.panel.Overview.superclass.constructor.call(this,e)},Ext.extend(modDevTools.panel.Overview,MODx.Panel),Ext.reg("moddevtools-panel-overview",modDevTools.panel.Overview),modDevTools.panel.SearchForm=function(e){e=e||{},Ext.applyIf(e,{cls:"container form-with-labels",labelAlign:"left",autoHeight:!0,anchor:"100%",saveMsg:_("search"),url:modDevTools.config.connectorUrl,errorReader:new Ext.data.JsonReader({totalProperty:"total",root:"results",fields:["id","name","class","type","content"]}),baseParams:{action:"mgr/search/getlist"},defaults:{border:!1},items:[{layout:"column",cls:"x-toolbar",style:{backgroundColor:"transparent"},defaults:{layout:"form",cls:"col-sm-4",border:!1},items:[{columnWidth:.4,items:[{xtype:"textfield",cls:"col-sm-4",id:"search-string",fieldLabel:_("moddevtools.text_to_find"),allowBlank:!1,anchor:"100%",border:!1,labelStyle:"line-height:24px;",listeners:{specialkey:function(e,t){13===t.getKey()&&this.submit()},scope:this}}]},{columnWidth:.4,items:[{xtype:"textfield",cls:"col-sm-4",id:"replace-string",fieldLabel:_("moddevtools.replace_with"),anchor:"100%",border:!1,labelStyle:"line-height:24px;",listeners:{specialkey:function(e,t){13===t.getKey()&&this.submit()},scope:this}}]},{columnWidth:.2,items:[{xtype:"button",cls:"col-sm-4 primary-button",align:"left",text:_("moddevtools.find"),handler:this.submit,scope:this,anchor:"100%",border:!1}]}]},{id:"filter-group",xtype:"fieldset",cls:"moddevtools-fieldset",title:_("moddevtools.search_filters"),layout:"auto",defaults:{style:{width:"auto",float:"left",marginRight:"25px"},border:!1},items:[{items:{xtype:"xcheckbox",name:"filters[modChunk]",hiddenName:"filters[modChunk]",id:"moddevtools-search-chunks",boxLabel:_("chunks"),inputValue:1,checked:!0,border:!1}},{items:{xtype:"xcheckbox",name:"filters[modTemplate]",hiddenName:"filters[modTemplate]",id:"moddevtools-search-templates",boxLabel:_("templates"),inputValue:1,checked:!0,border:!1}}]},{id:"moddevtools-search-results"}],listeners:{success:{fn:function(e){var t=Ext.getCmp("moddevtools-search-results");if(t.removeAll(),e.result.success&&e.result.errors){var o=e.result.errors;this.records=o;for(var s=0;s<o.length;s++){var i={xtype:"panel",title:_(o[s].type)+" "+o[s].name+" ("+o[s].id+")",headerCfg:{cls:"moddevtools-el-header",style:{"font-weight":"700",background:"#e4e9ee",color:"#696969"}},items:[{id:"found-element-"+s,xtype:"displayfield",value:o[s].content,height:"auto",cls:"moddevtools-search-code"}],bbar:[{xtype:"button",text:_("moddevtools.replace"),handler:this.replace.createDelegate(this,[s,!1,!1],!1),scope:this},{xtype:"button",text:_("moddevtools.replace_all"),handler:this.replace.createDelegate(this,[s,!0,!1],!1),scope:this},{xtype:"button",text:_("moddevtools.skip"),handler:this.replace.createDelegate(this,[s,!1,!0],!1),scope:this},"->",{xtype:"splitbutton",text:_("moddevtools.edit"),handler:this.edit.createDelegate(this,[s],!0),menu:new Ext.menu.Menu({cls:"x-menu-no-icon",items:[{text:'<i class="icon icon-edit"></i> '+_("moddevtools.edit"),iconCls:"no-icon",handler:this.edit.createDelegate(this,[s],!0),scope:this},{text:'<i class="icon icon-clone"></i> '+_("moddevtools.duplicate"),iconCls:"no-icon",handler:this.duplicate.createDelegate(this,[s],!0),scope:this}]}),scope:this},{xtype:"splitbutton",text:_("moddevtools.quickedit"),handler:this.quickedit.createDelegate(this,[s],!0),menu:new Ext.menu.Menu({cls:"x-menu-no-icon",items:[{text:'<i class="icon icon-edit"></i> '+_("moddevtools.quickedit"),iconCls:"no-icon",handler:this.quickedit.createDelegate(this,[s],!0),scope:this},{text:'<i class="icon icon-clone"></i> '+_("moddevtools.quickduplicate"),iconCls:"no-icon",handler:this.quickduplicate.createDelegate(this,[s],!0),scope:this}]}),scope:this}]};t.add(i)}}else t.add({html:"<h3>"+_("moddevtools.notfound")+"</h3>",style:{margin:"10px 0"}});t.doLayout()},scope:this}}}),modDevTools.panel.SearchForm.superclass.constructor.call(this,e)},Ext.extend(modDevTools.panel.SearchForm,MODx.FormPanel,{edit:function(e,t,o){o=this.records[o];MODx.loadPage("element/"+o.type+"/update","id="+o.id)},duplicate:function(e,o,t){var s=this.records[t];MODx.Ajax.request({url:MODx.config.connector_url,params:{action:"element/"+s.type+"/get",id:s.id},listeners:{success:{fn:function(e){var t={id:e.object.id,type:s.type,name:_("duplicate_of",{name:s.name}),source:e.object.source,static:e.object.static,static_file:e.object.static_file,category:e.object.category};MODx.load({xtype:"modx-window-element-duplicate",record:t,listeners:{success:{fn:function(e){e=Ext.decode(e.a.response.responseText);MODx.loadPage("element/"+t.type+"/update","id="+e.object.id)},scope:this},hide:{fn:function(){this.destroy()}}}}).show(o.target)},scope:this}}})},quickedit:function(s,e,i){var n=this.records[i];MODx.Ajax.request({url:MODx.config.connector_url,params:{action:"element/"+n.type+"/get",id:n.id},listeners:{success:{fn:function(e){var t="template"===n.type?"templatename":"name",o=MODx.load({xtype:"modx-window-quick-update-"+n.type,record:e.object,listeners:{success:{fn:function(){this.replace(i,!1,!0)},scope:this},hide:{fn:function(){this.destroy()}}}});o.title+=': <span dir="ltr">'+o.record[t]+" ("+o.record.id+")</span>",o.setValues(e.object),o.show(s.target)},scope:this}}})},quickduplicate:function(s,e,t){var i=this.records[t];MODx.Ajax.request({url:MODx.config.connector_url,params:{action:"element/"+i.type+"/get",id:i.id},listeners:{success:{fn:function(e){var t="template"===i.type?"templatename":"name",e=e.object,o=(e[t]=_("duplicate_of",{name:e[t]}),e.id=null,MODx.load({xtype:"modx-window-quick-create-"+i.type,title:_("quick_create_"+i.type),record:e,listeners:{success:{fn:function(){this.destroy()}},hide:{fn:function(){this.destroy()}}}}));o.title+=': <span dir="ltr">'+o.record[t]+"</span>",o.setValues(e),o.show(s.target)},scope:this}}})},replace:function(t,e,o){var s=this.records[t],i=this.getForm();MODx.Ajax.request({url:modDevTools.config.connectorUrl,params:{id:s.id,class:s.class,action:"mgr/search/replace",offset:e?0:s.offset,search:i.findField("search-string").getValue(),replace:i.findField(o?"search-string":"replace-string").getValue(),all:e},listeners:{success:{fn:function(e){e.success&&void 0!==e.object&&(Ext.getCmp("found-element-"+t).setValue(e.object.content),this.records[t]=e.object)},scope:this}}})}}),Ext.reg("moddevtools-search-form",modDevTools.panel.SearchForm),modDevTools.panel.RegenerateForm=function(e){e=e||{},Ext.applyIf(e,{cls:"container form-with-labels",labelAlign:"left",autoHeight:!0,anchor:"100%",url:modDevTools.config.connectorUrl,baseParams:{action:"mgr/tables/regenerate",register:"mgr",topic:"/regenerate/"},items:[{id:"regenerate-group",xtype:"fieldset",cls:"moddevtools-fieldset",title:_("moddevtools.regenerate_filters"),layout:"auto",defaults:{style:{width:"auto",float:"left",marginRight:"25px"},border:!1},items:[{items:{xtype:"checkbox",name:"filters[]",hiddenName:"filters[]",inputValue:"modChunk",id:"moddevtools-search-chunks",boxLabel:_("chunks"),checked:!0,border:!1}},{items:{xtype:"checkbox",name:"filters[]",hiddenName:"filters[]",inputValue:"modTemplate",id:"moddevtools-search-templates",boxLabel:_("templates"),checked:!0,border:!1}},{items:{xtype:"checkbox",name:"filters[]",hiddenName:"filters[]",inputValue:"modResource",id:"moddevtools-search-resources",boxLabel:_("resources"),checked:!0,border:!1}}]}],buttons:[{cls:"primary-button",text:_("moddevtools.regenerate"),scope:this,handler:function(){var e=this.getForm();null===this.console||void 0===this.console||this.console.isDestroyed?this.console=MODx.load({xtype:"modx-console",register:"mgr",topic:"/regenerate/"}):this.console.setRegister("mgr","/regenerate/"),this.console.show(Ext.getBody()),e.submit({success:{fn:function(){this.console.fireEvent("complete")},scope:this}})}}]}),modDevTools.panel.RegenerateForm.superclass.constructor.call(this,e)},Ext.extend(modDevTools.panel.RegenerateForm,MODx.FormPanel,{}),Ext.reg("moddevtools-regenerate-form",modDevTools.panel.RegenerateForm),modDevTools.BreadcrumbsPanel=function(e){e=e||{},Ext.applyIf(e,{bdMarkup:'<tpl if="typeof(trail) != &quot;undefined&quot;"><div class="crumb_wrapper"><ul class="crumbs"><tpl for="trail"><li{[values.className != undefined ? \' class="\'+values.className+\'"\' : \'\' ]}><tpl if="typeof url != \'undefined\'"><button type="button" data-url="{url}" class="controlBtn {[values.root ? \' root\' : \'\' ]}">{text}</button></tpl><tpl if="typeof url == \'undefined\'"><span class="text{[values.root ? \' root\' : \'\' ]}">{text}</span></tpl></li></tpl></ul></div></tpl>',bodyStyle:{background:"transparent"}}),modDevTools.BreadcrumbsPanel.superclass.constructor.call(this,e)},Ext.extend(modDevTools.BreadcrumbsPanel,MODx.BreadcrumbsPanel,{onClick:function(e){var e=e.getTarget();void 0!==e&&(e=e.getAttribute("data-url"))&&MODx.loadPage(e)},_updatePanel:function(e){this.tpl.overwrite(this.body,e);var t=this;setTimeout(function(){t.ownerCt.doLayout()},200)},getPagetitle:function(){var e,t=Ext.getCmp("modx-resource-pagetitle");return void 0!==t?0===(e=t.getValue()).length&&(e=_("new_document")):e="",e}}),Ext.reg("moddevtools-breadcrumbs-panel",modDevTools.BreadcrumbsPanel),modDevTools.panel.Elements=function(e){e=e||{};var t=Ext.get("modx-content").query(".x-panel .container")?Ext.get("modx-content").query(".x-panel .container")[0].id:"",t=t?t.split("-").pop():"chunk",t=(Ext.apply(e,{border:!1,baseCls:"modx-formpanel",cls:"moddevtools-element-panel",layout:"auto",width:"100%",editors:this.editors,parentPanel:Ext.getCmp("modx-panel-"+t),duplicateButtons:!1,items:[{html:e.intro,border:!1,cls:"panel-desc"},{baseCls:"main-wrapper",items:[{layout:"accordion",border:!1,layoutConfig:{animate:!0},defaults:{renderHidden:!0,stateEvents:["collapse","expand"],getState:function(){return{collapsed:this.collapsed}},border:!1},items:[]}]}]}),this.getElements(),Ext.getCmp("modx-"+t+"-tabs"));t&&!t.isDevToolsEventSet&&(t.addListener("tabchange",function(e,t){"moddevtools-template-chunks-tab"===t.id||"moddevtools-template-snippets-tab"===t.id?this.updateSaveButton(!0):this.updateSaveButton(!1)},this),t.isDevToolsEventSet=!0),e.parentPanel.on("success",function(){this.getElements()},this),this.config=e,modDevTools.panel.Elements.superclass.constructor.call(this,e)},Ext.extend(modDevTools.panel.Elements,MODx.Panel,{getElements:function(){var l=this.config.config,e=this.config.params;new Ext.data.JsonStore({url:modDevTools.config.connectorUrl,baseParams:e,autoLoad:!0,fields:["id","name","snippet"],root:"results",totalProperty:"total",autoDestroy:!0,listeners:{load:{fn:function(e,t){this.items.itemAt(1).removeAll();for(var o=0;o<t.length;o++){var s=t[o].data,i="save"+l.element.charAt(0).toUpperCase()+l.element.substr(1),n=["->",{xtype:"button",text:_("moddevtools.duplicate"),handler:this.duplicateElement.createDelegate(this,[l.element,s.id],!0),scope:this},{xtype:"button",text:_("moddevtools.quickduplicate"),handler:this.quickduplicateElement.createDelegate(this,[l.element,s.id],!0),scope:this}],i={stateId:"state"+s.id,id:"tools-"+l.element+"-"+o,title:s.name+" ("+s.id+")",cls:"tools-item",headerCfg:{style:{padding:"10px","font-weight":"700",background:"#e4e9ee",color:"#696969"}},keys:[{key:"s",ctrl:!0,fn:function(){this.focusedButton.fireEvent("click")},scope:this}],autoHeight:!0,items:[{cls:"main-wrapper moddevtools-element",style:{border:"1px solid #f0f0f0"},layout:"anchor",items:[{xtype:Ext.ComponentMgr.types["modx-texteditor"]&&modDevTools.config[i]?"modx-texteditor":"textarea",mimeType:l.mimeType,modxTags:l.modxTags,value:this.getElementValue(s),anchor:"100%",label:!1,height:300,id:l.element+"-editor-"+s.id,record:s,enableKeyEvents:!0,readOnly:!modDevTools.config[i],listeners:{keyup:{fn:function(){var e=Ext.getCmp("save-"+l.element+"-"+this.record.id);this.value!==this.getValue()?e.disabled&&e.setDisabled(!1):e.disabled||e.setDisabled(!0)}},focus:{fn:function(e){this.focusedEditor=e,this.focusedButton=Ext.getCmp("save-"+l.element+"-"+e.record.id),this.updateSaveButton(!0)},scope:this},afterrender:{fn:function(e){var t,o,s;"modx-texteditor"===e.xtype&&(t=e.editor,o=this.parentPanel.record.name,t.findAll(o),0<(e=this.highlightElements(t,o)).length&&t.gotoLine(e[0].end.row+1,e[0].end.column),s=this,t.getSession().on("change",function(){s.highlightElements(t,o)}))},scope:this}}},this.loadProperties(s)],bbar:modDevTools.config[i]?[{xtype:"button",id:"save-"+l.element+"-"+s.id,text:_("save"),cls:"primary-button",input:l.element+"-editor-"+s.id,disabled:!0,keys:[{key:MODx.config.keymap_save||"s",ctrl:!0}],handler:this.saveElement.createDelegate(this,[l.element+"-editor-"+s.id],!0),scope:this},"chunk"===l.element||"template"===l.element?n:[]]:""}],listeners:{beforecollapse:{fn:function(e,t){return!0!==t},scope:this}},collapsed:!1,collapsible:!0};this.items.itemAt(1).add(i)}this.doLayout()},scope:this}}})},getUpdateParams:function(e){return{action:"element/"+this.config.config.element+"/update",id:e.record.id,name:e.record.name,snippet:e.getValue()}},updateSaveButton:function(e){var t=Ext.getCmp("modx-abtn-save");t&&t.setDisabled(e)},highlightElements:function(e,t){var o,s=e.getSession().getMarkers(!1);for(o in s)0===s[o].clazz.indexOf("ace_selected-word")&&e.getSession().removeMarker(o);e.$search.set({needle:t});for(var i=e.$search.findAll(e.session),n=0;n<i.length;n++)e.getSession().addMarker(i[n],"ace_selected-word","text");return i},saveElement:function(t,e,o){if(this.disabled)return!1;var s=Ext.getCmp(o);t.setText(_("saving")),MODx.Ajax.request({url:MODx.config.connector_url,params:this.getUpdateParams(s),listeners:{success:{fn:function(e){e.success&&(s.value=s.getValue(),t.setDisabled(!0),t.setText(_("save")))},scope:this}}})},duplicateElement:function(e,o,s,t){var i="template"===s?"templatename":"name";MODx.Ajax.request({url:MODx.config.connector_url,params:{action:"element/"+s+"/get",id:t},listeners:{success:{fn:function(e){var t={id:e.object.id,type:s,name:_("duplicate_of",{name:e.object[i]}),source:e.object.source,static:e.object.static,static_file:e.object.static_file,category:e.object.category};MODx.load({xtype:"modx-window-element-duplicate",record:t,listeners:{success:{fn:function(e){e=Ext.decode(e.a.response.responseText);MODx.loadPage("element/"+t.type+"/update","id="+e.object.id)},scope:this},hide:{fn:function(){this.destroy()}}}}).show(o.target)},scope:this}}})},quickduplicateElement:function(o,e,s,t){var i="template"===s?"templatename":"name";MODx.Ajax.request({url:MODx.config.connector_url,params:{action:"element/"+s+"/get",id:t},listeners:{success:{fn:function(e){var e=e.object,t=(e[i]=_("duplicate_of",{name:e[i]}),e.id=null,MODx.load({xtype:"modx-window-quick-create-"+s,title:_("quick_create_"+s),record:e,listeners:{success:{fn:function(){this.destroy()}},hide:{fn:function(){this.destroy()}}}}));t.title+=': <span dir="ltr">'+t.record[i]+"</span>",t.setValues(e),t.show(o.target)},scope:this}}})}}),modDevTools.panel.Chunks=function(e){e=e||{},Ext.applyIf(e,{id:"tools-panel-chunks",duplicateButtons:!0,params:{action:"mgr/chunk/getlist",parent:MODx.request.id,link_type:e.link_type},config:{element:"chunk",mimeType:"text/html",modxTags:!0}}),this.config=e,modDevTools.panel.Chunks.superclass.constructor.call(this,e)},Ext.extend(modDevTools.panel.Chunks,modDevTools.panel.Elements,{getElementValue:function(e){return e.snippet||""},loadProperties:function(){return!1}}),Ext.reg("moddevtools-panel-chunks",modDevTools.panel.Chunks),modDevTools.panel.Snippets=function(e){e=e||{},Ext.apply(e,{id:"tools-panel-snippets",params:{action:"mgr/snippet/getlist",parent:MODx.request.id,link_type:e.link_type},config:{element:"snippet",mimeType:"application/x-php",modxTags:!1}}),this.config=e,modDevTools.panel.Snippets.superclass.constructor.call(this,e)},Ext.extend(modDevTools.panel.Snippets,modDevTools.panel.Elements,{getElementValue:function(e){return"<?php\r\n"+(e.snippet||"")},loadProperties:function(t){return{xtype:"panel",listeners:{beforerender:{fn:function(e){e.add({title:_("properties"),headerCfg:{style:{background:"#f0f0f0",margin:"10px 0 0",padding:"10px",cursor:"pointer"}},items:[{xtype:"moddevtools-grid-properties",pk:t.id,style:{padding:"10px",border:"1px solid #ececec"}}],collapsible:!0,collapsed:!0,listeners:{afterrender:function(e){e.header.on("click",function(){e.collapsed?e.expand():e.collapse()})}}}),e.doLayout()},scope:this}}}}}),Ext.reg("moddevtools-panel-snippets",modDevTools.panel.Snippets),modDevTools.panel.Templates=function(e){e=e||{},Ext.apply(e,{id:"tools-panel-templates",params:{action:"mgr/template/getlist",child:MODx.request.id,link_type:e.link_type},config:{element:"template",mimeType:"text/html",modxTags:!0}}),this.config=e,modDevTools.panel.Templates.superclass.constructor.call(this,e)},Ext.extend(modDevTools.panel.Templates,modDevTools.panel.Elements,{getUpdateParams:function(e){return{action:"element/"+this.config.config.element+"/update",id:e.record.id,templatename:e.record.name,content:e.getValue()}},getElementValue:function(e){return e.snippet||""},loadProperties:function(){return!1}}),Ext.reg("moddevtools-panel-templates",modDevTools.panel.Templates),modDevTools.grid.Resources=function(e){(e=e||{}).id||(e.id="moddevtools-grid-resources"),this.config=e,Ext.applyIf(e,{url:modDevTools.config.connectorUrl,fields:["id","pagetitle","description","published","createdon","actions","preview_url","template"],columns:[{header:_("id"),dataIndex:"id",sortable:!0,width:20},{header:_("pagetitle"),dataIndex:"pagetitle",sortable:!0,editable:!0,width:150},{header:_("published"),dataIndex:"published",renderer:modDevTools.util.yesnoRenderer,sortable:!0,width:40},{header:_("createdon"),dataIndex:"createdon",renderer:modDevTools.util.dateRenderer(MODx.config.manager_date_format+" "+MODx.config.manager_time_format),sortable:!0,width:50},{header:_("moddevtools.template"),dataIndex:"template",sortable:!1,hidden:!0},{header:_("moddevtools.grid_actions"),renderer:modDevTools.util.actionsRenderer,width:60,menuDisabled:!0,id:"actions"}],tbar:!1,autoExpandColumn:"pagetitle",baseParams:{action:"mgr/resource/getlist",sort:"createdon",dir:"DESC",id:MODx.request.id,link_type:e.link_type},viewConfig:{forceFit:!0,enableRowBody:!0,autoFill:!0,showPreview:!0,scrollOffset:0,getRowClass:function(e){return e.data.published?"":"moddevtools-row-disabled"}},paging:!0,remoteSort:!0,autoHeight:!0}),this.config=e,modDevTools.grid.Resources.superclass.constructor.call(this,e)},Ext.extend(modDevTools.grid.Resources,MODx.grid.Grid,{windows:{},getMenu:function(e,t){var o=this._getSelectedIds(),e=e.getStore().getAt(t),t=modDevTools.util.getMenu(e.data.actions,this,o);this.addContextMenuItem(t)},_getSelectedIds:function(){var e,t=[],o=this.getSelectionModel().getSelections();for(e in o)o.hasOwnProperty(e)&&t.push(o[e].id);return t},_getResId:function(){var e=this._getSelectedIds();return!!e.length&&e[0]},updateResource:function(e){var t=this._getResId();if(!t)return!1;MODx.Ajax.request({url:MODx.config.connector_url,params:{action:"resource/"+e,id:t},listeners:{success:{fn:function(){this.refresh()},scope:this}}})},unpublishResource:function(){this.updateResource("unpublish")},publishResource:function(){this.updateResource("publish")},removeResource:function(){this.updateResource("delete")},undeleteResource:function(){this.updateResource("undelete")},editResource:function(){var e=this._getResId();if(!e)return!1;MODx.loadPage("resource/update&id="+e)},previewResource:function(){window.open(this.menu.record.preview_url)},changeTemplate:function(e,t){var o=this.getSelectionModel().getSelections();if(o.length<=0)return!1;o=o[0].data;return this.changeTemplateWindow||(this.changeTemplateWindow=MODx.load({xtype:"moddevtools-window-change-template",record:o,listeners:{success:{fn:function(){this.refresh()},scope:this}}})),this.changeTemplateWindow.setValues(o),this.changeTemplateWindow.show(t.target),!0},onClick:function(e){var t=e.getTarget(".action",2,!0);if(t){var o=this.getSelectionModel().getSelected();if(void 0!==o){var s,t=t.getAttribute("data-action");if("showMenu"===t)return s=this.getStore().find("id",o.id),this._showMenu(this,s,e);if("function"==typeof this[t])return this.menu.record=o.data,this[t](this,e)}}return this.processEvent("click",e)}}),Ext.reg("moddevtools-grid-resources",modDevTools.grid.Resources),modDevTools.window.ChangeTemplate=function(e){e=e||{},Ext.applyIf(e,{title:_("moddevtools.template_change"),url:modDevTools.config.connectorUrl,baseParams:{action:"mgr/resource/changetemplate"},width:400,fields:[{xtype:"hidden",name:"id"},{xtype:"modx-combo-template",fieldLabel:_("template"),name:"template",hiddenName:"template",anchor:"100%"}]}),modDevTools.window.ChangeTemplate.superclass.constructor.call(this,e)},Ext.extend(modDevTools.window.ChangeTemplate,MODx.Window),Ext.reg("moddevtools-window-change-template",modDevTools.window.ChangeTemplate),modDevTools.grid.Properties=function(e){e=e||{},this.ident="moddevtools-properties-"+Ext.id(),Ext.applyIf(e,{id:this.ident,url:modDevTools.config.connectorUrl,baseParams:{action:"mgr/element/getproperties",classKey:"modSnippet",propertySet:0,pk:e.pk},cls:"modx-grid modx-grid-small modx"+modDevTools.config.modxversion,fields:["fieldLabel","value","description"],showActionsColumn:!1,columns:[{header:_("moddevtools.property_default"),dataIndex:"fieldLabel",width:100,renderer:function(e,t,o){return"&"+e+"=`"+o.data.value+"`"}},{header:_("moddevtools.description"),dataIndex:"description",width:200}],paging:!1,showPerPage:!1}),modDevTools.grid.Properties.superclass.constructor.call(this,e)},Ext.extend(modDevTools.grid.Properties,MODx.grid.Grid,{}),Ext.reg("moddevtools-grid-properties",modDevTools.grid.Properties),MODx.grid.SettingsGrid&&(modDevTools.panel.Settings=function(e){e=e||{},MODx.request.ns="moddevtools",Ext.applyIf(e,{id:"moddevtools-panel-settings",title:_("moddevtools.settings"),items:[{html:"<p>"+_("moddevtools.settings_desc")+"</p>",border:!1,cls:"panel-desc"},{xtype:"moddevtools-grid-system-settings",id:"moddevtools-grid-system-settings",cls:"main-wrapper",preventSaveRefresh:!0}]}),modDevTools.panel.Settings.superclass.constructor.call(this,e)},Ext.extend(modDevTools.panel.Settings,MODx.Panel),Ext.reg("moddevtools-panel-settings",modDevTools.panel.Settings),modDevTools.grid.SystemSettings=function(e){(e=e||{}).baseParams={action:"system/settings/getList",namespace:"moddevtools",area:MODx.request.area},e.tbar=[],modDevTools.grid.SystemSettings.superclass.constructor.call(this,e)},Ext.extend(modDevTools.grid.SystemSettings,MODx.grid.SettingsGrid,{_showMenu:function(e,t,o){o.stopEvent(),o.preventDefault(),this.menu.record=this.getStore().getAt(t).data,this.getSelectionModel().isSelected(t)||this.getSelectionModel().selectRow(t),this.menu.removeAll();t=[];this.menu.record.menu?t=this.menu.record.menu:t.push({text:_("setting_update")||_("edit"),handler:this.updateSetting}),0<t.length&&(this.addContextMenuItem(t),this.menu.showAt(o.xy))},updateSetting:function(e,t){var o=this.menu.record,s=(o.fk=Ext.isDefined(this.config.fk)?this.config.fk:0,MODx.load({xtype:"modx-window-setting-update",url:modDevTools.config.connectorUrl,action:"mgr/settings/update",record:o,grid:this,listeners:{success:{fn:function(){this.refresh()},scope:this}}}));s.reset(),s.setValues(o),s.show(t.target)},clearFilter:function(){var e="moddevtools",t=MODx.request.area||"",o=(this.getStore().baseParams=this.initialConfig.baseParams,Ext.getCmp("modx-filter-area"));o&&(o.store.baseParams.namespace=e,o.store.load(),o.reset()),Ext.getCmp("modx-filter-namespace").setValue(e),Ext.getCmp("modx-filter-key").reset(),this.getStore().baseParams.namespace=e,this.getStore().baseParams.area=t,this.getStore().baseParams.key="",this.getBottomToolbar().changePage(1)},filterByKey:function(e,t){return this.getStore().baseParams.key=t,this.getStore().baseParams.namespace="moddevtools",this.getBottomToolbar().changePage(1),!0},filterByNamespace:function(){this.getStore().baseParams.namespace="moddevtools",this.getStore().baseParams.area="",this.getBottomToolbar().changePage(1);var e,t=Ext.getCmp("modx-filter-area");t&&((e=t.store).baseParams.namespace="moddevtools",e.removeAll(),e.load(),t.setValue(""))},listeners:{afterrender:function(){Ext.getCmp("modx-filter-namespace").hide()}}}),Ext.reg("moddevtools-grid-system-settings",modDevTools.grid.SystemSettings)),modDevTools.page.Home=function(e){e=e||{},Ext.applyIf(e,{buttons:[{text:_("help_ex"),handler:MODx.loadHelpPane}],formpanel:"moddevtools-panel-home",components:[{xtype:"moddevtools-panel-home"}]}),modDevTools.page.Home.superclass.constructor.call(this,e)},Ext.extend(modDevTools.page.Home,MODx.Component),Ext.reg("moddevtools-page-home",modDevTools.page.Home);